(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/recharge"],{"068c":function(a,t,e){"use strict";e.r(t);var n=e("adaf"),o=e("3107");for(var c in o)"default"!==c&&function(a){e.d(t,a,function(){return o[a]})}(c);e("4ed9");var r=e("2877"),d=Object(r["a"])(o["default"],n["a"],n["b"],!1,null,"bbf12ac4",null);t["default"]=d.exports},3107:function(a,t,e){"use strict";e.r(t);var n=e("86b7"),o=e.n(n);for(var c in n)"default"!==c&&function(a){e.d(t,a,function(){return n[a]})}(c);t["default"]=o.a},"4ed9":function(a,t,e){"use strict";var n=e("f2d6"),o=e.n(n);o.a},"86b7":function(a,t,e){"use strict";(function(a,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=e("2f62"),c=e("d441"),r=d(e("ee6a"));function d(a){return a&&a.__esModule?a:{default:a}}function u(a){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},n=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e).filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.forEach(function(t){s(a,t,e[t])})}return a}function s(a,t,e){return t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}var i=function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"e3a6"))},l=getApp(),f={data:function(){return{cardId:l.globalData.cardId,isPayByBalance:!0,product_id:"",product_name:"",is_next_use:0,payMode:l.globalData.payMode,passWord:"",userValue:null,checked:!0,isTaped:!1,balance:l.globalData.balance,amount:0}},computed:u({},(0,o.mapState)("rechargeData",["bgTop","amountList","orderInfo","wxIcon","balanceIcon"]),(0,o.mapState)(["openID","passwordExist"])),watch:{isPayByBalance:function(a,t){a&&(this.isTaped=!1)}},onLoad:function(a){this.product_id=a.product_id,this.product_name=a.product_name,this.amount=parseFloat(a.amount),this.is_next_use=a.is_next_use},onShow:function(){var a=this;""!=l.globalData.cardId&&(0,c.getCheckCardByNumber)(l.globalData.cardId).then(function(t){200==t.statusCode&&""!=t.data.card_no&&(a.asyncSetting({ispName:t.data.operator,docUrl:t.data.use_doc_url,passwordExist:t.data.password_exist,needUnbind:t.data.need_unbind,certStatus:t.data.cert_status,supportRecover:t.data.support_recover,payMode:t.data.pay_mode,canTg:t.data.can_tg}),l.globalData.balance=t.data.balance,l.globalData.certStatus=t.data.cert_statu,a.balance=t.data.balance)})},mounted:function(){},methods:u({toChangeSuit:function(){a.navigateTo({url:"/pages/set-meals"})},toUser:function(){a.switchTab({url:"/pages/user"})},checkedChange:function(a){console.log(n(a.detail.value[0]," at pages\\recharge.vue:170"))},closeModefyPop:function(){this.$refs.pwdInputPopup.close(),this.isTaped=!1},toChangePwd:function(){a.navigateTo({url:"/pages/change-pwd"})},toConfirm:function(){var t=this;""==l.globalData.cardId?a.navigateTo({url:"/pages/change"}):""==this.product_id?a.navigateTo({url:"/pages/set-meals"}):(0,c.getSiutStatus)({product_id:this.product_id,card_no:this.cardId,effect_type:this.is_next_use}).then(function(e){0==e.data.code?"通用模式"!=l.globalData.payMode||t.isPayByBalance?t.balance<t.amount?a.showModal({title:"提示",content:"余额不足，请充值",showCancel:!1}):0==t.passwordExist?a.navigateTo({url:"/pages/set-password"}):(t.$refs.pwdInputPopup.open(),t.isTaped=!0):(0,c.getPayDataByWx)({product_id:t.product_id,effect_type:t.is_next_use,card_no:t.cardId}).then(function(t){200==t.statusCode&&a.requestPayment({provider:"wxpay",orderInfo:t.data.result,success:function(a){(0,c.getCheckCardByNumber)(l.globalData.cardId).then(function(a){l.globalData.balance=a.data.balance,l.globalData.certStatus=a.data.cert_statu})},fail:function(a){console.log(n("fail:"+JSON.stringify(a)," at pages\\recharge.vue:208"))}})}):a.showToast({title:e.data.msg,icon:"none"})})},toBlancePay:function(){var t=this;(0,c.validPassWord)({card_no:l.globalData.cardId,pay_password:t.passWord}).then(function(e){t.blanceConfirm=!1,0==e.data.code?a.request({url:r.default+"wx/charge_with_balance",method:"POST",data:{card_no:l.globalData.cardId,product_id:t.product_id,effect_type:t.is_next_use,source:"app"},success:function(e){0==e.data.code&&a.showModal({title:"提示",content:e.data.msg?e.data.msg:"支付成功",showCancel:!1,complete:function(a){(0,c.getCheckCardByNumber)(l.globalData.cardId).then(function(a){l.globalData.balance=a.data.balance,l.globalData.certStatus=a.data.cert_statu,t.blanceConfirm=!1}),this.$refs.pwdInputPopup.close()}})}}):a.showToast({title:e.data.msg,icon:"none"})})},toPayRecharge:function(t){var e=this;""==l.globalData.cardId?a.navigateTo({url:"/pages/set-meals"}):(0,c.getRechargePayBy)({amount:e.amountList[t].value,card_no:l.globalData.cardId,open_id:e.openID}).then(function(t){200==t.statusCode?a.requestPayment({provider:"wxpay",orderInfo:t.data.result,success:function(t){(0,c.getCheckCardByNumber)(l.globalData.cardId).then(function(t){l.globalData.balance=t.data.balance,l.globalData.certStatus=t.data.cert_statu,e.balance=t.data.balance,e.blanceConfirm=!1,a.showModal({title:"提示",content:"充值成功，您是否现在就订购已选套餐呢？",cancelText:"稍后购买",confirmText:"立刻购买",confirmColor:"#007aff",success:function(){(0,c.getSiutStatus)({product_id:e.product_id,card_no:e.cardId,effect_type:e.is_next_use}).then(function(n){0==n.data.code?t.data.balance>e.amount?a.request({url:r.default+"wx/charge_with_balance",method:"POST",data:{card_no:l.globalData.cardId,product_id:e.product_id,effect_type:e.is_next_use},success:function(t){0==t.data.code&&a.showToast({title:t.data.msg,success:function(){(0,c.getCheckCardByNumber)(l.globalData.cardId).then(function(a){l.globalData.balance=a.data.balance,l.globalData.certStatus=a.data.cert_statu,e.balance=a.data.balance})}})}}):a.showToast({title:"对不起卡内余额不足以支付该套餐",icon:"none"}):a.showToast({title:n.data.msg,icon:"none"})})}})})},fail:function(a){console.log(n("fail:"+JSON.stringify(a)," at pages\\recharge.vue:358"))}}):e.reBindOpenId()})},reBindOpenId:function(){a.request({url:r.default+"wx/app_user_info",method:"POST",data:{open_id:l.globalData.openId,union_id:l.globalData.unionId,nike_name:l.globalData.nickName,sex:"",city:"",province:"",country:"",head_img_url:l.globalData.avatarUrl},success:function(a){"undefined"!=typeof a.data.data.card_no&&""!=a.data.data.card_no&&console.log(n("绑定成功"+a," at pages\\recharge.vue:383"))},fail:function(a){console.log(n(a," at pages\\recharge.vue:387"))}})},payUserDefine:function(){""==l.globalData.cardId?a.navigateTo({url:"/pages/set-meals"}):this.userValue>0?(0,c.getRechargePayBy)({amount:this.userValue,card_no:l.globalData.cardId,open_id:this.openID}).then(function(t){200==t.statusCode?a.requestPayment({provider:"wxpay",orderInfo:t.data.result,success:function(a){var t=this;(0,c.getCheckCardByNumber)(l.globalData.cardId).then(function(a){l.globalData.balance=a.data.balance,l.globalData.certStatus=a.data.cert_statu,t.blanceConfirm=!1})},fail:function(a){console.log(n("fail:"+JSON.stringify(a)," at pages\\recharge.vue:413"))}}):that.reBindOpenId()}):a.showToast({title:"自定义金额中输入大于0的数字",icon:none})}},(0,o.mapActions)(["asyncSetting"])),components:{uniPopup:i}};t.default=f}).call(this,e("6e42")["default"],e("0de9")["default"])},"90d8":function(a,t,e){"use strict";(function(a){e("8602"),e("921b");n(e("66fd"));var t=n(e("068c"));function n(a){return a&&a.__esModule?a:{default:a}}a(t.default)}).call(this,e("6e42")["createPage"])},adaf:function(a,t,e){"use strict";var n=function(){var a=this,t=a.$createElement;a._self._c;a._isMounted||(a.e0=function(t){a.isPayByBalance=t.target.value},a.e1=function(t){a.isTaped=t.show})},o=[];e.d(t,"a",function(){return n}),e.d(t,"b",function(){return o})},f2d6:function(a,t,e){}},[["90d8","common/runtime","common/vendor"]]]);